<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Autenticaci√≥n</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .form-container { max-width: 400px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        input { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .hidden { display: none; }
        #output { margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üß™ Test de Autenticaci√≥n</h1>
    
    <div id="authSection" class="form-container">
        <h2>Registro</h2>
        <form id="registerForm">
            <input type="email" id="registerEmail" placeholder="Email" required>
            <input type="password" id="registerPassword" placeholder="Contrase√±a" required>
            <button type="submit">Registrar</button>
        </form>
        
        <h2>Login</h2>
        <form id="loginForm">
            <input type="email" id="loginEmail" placeholder="Email" required>
            <input type="password" id="loginPassword" placeholder="Contrase√±a" required>
            <button type="submit">Iniciar Sesi√≥n</button>
        </form>
    </div>
    
    <div id="appSection" class="form-container hidden">
        <h2>¬°Bienvenido!</h2>
        <p id="welcomeMessage">Usuario logueado</p>
        <button id="logoutBtn">Cerrar Sesi√≥n</button>
        <button id="showUsersBtn">Mostrar Usuarios</button>
    </div>
    
    <div id="output"></div>

    <script>
        console.log('üöÄ Test de autenticaci√≥n iniciado');
        
        // Funciones de localStorage
        const getUsers = () => JSON.parse(localStorage.getItem('users')) || [];
        const saveUsers = (users) => localStorage.setItem('users', JSON.stringify(users));
        const getCurrentUser = () => localStorage.getItem('currentUser');
        const setCurrentUser = (email) => localStorage.setItem('currentUser', email);
        const clearCurrentUser = () => localStorage.removeItem('currentUser');
        
        // Elementos del DOM
        const authSection = document.getElementById('authSection');
        const appSection = document.getElementById('appSection');
        const registerForm = document.getElementById('registerForm');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const welcomeMessage = document.getElementById('welcomeMessage');
        const showUsersBtn = document.getElementById('showUsersBtn');
        const output = document.getElementById('output');
        
        function log(message) {
            console.log(message);
            output.innerHTML += `<div>${message}</div>`;
        }
        
        // Verificar elementos
        log('üîç Verificando elementos del DOM:');
        log(`registerForm: ${registerForm ? '‚úÖ' : '‚ùå'}`);
        log(`loginForm: ${loginForm ? '‚úÖ' : '‚ùå'}`);
        log(`authSection: ${authSection ? '‚úÖ' : '‚ùå'}`);
        log(`appSection: ${appSection ? '‚úÖ' : '‚ùå'}`);
        
        // Funciones de vista
        function showAppView(email) {
            log(`‚úÖ Mostrando app para: ${email}`);
            const username = email.split('@')[0];
            welcomeMessage.textContent = `üëã Bienvenido, ${username}`;
            authSection.classList.add('hidden');
            appSection.classList.remove('hidden');
        }
        
        function showAuthView() {
            log('üîí Mostrando vista de autenticaci√≥n');
            authSection.classList.remove('hidden');
            appSection.classList.add('hidden');
            clearCurrentUser();
        }
        
        // Event listeners
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            log('üîÑ Procesando registro...');
            
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            log(`üìß Email: ${email}`);
            log(`üîê Password length: ${password.length}`);
            
            const users = getUsers();
            log(`üë• Usuarios actuales: ${users.length}`);
            
            if (users.find(user => user.email === email)) {
                log('‚ùå Email ya existe');
                alert('Este email ya est√° registrado');
                return;
            }
            
            users.push({ email, password });
            saveUsers(users);
            setCurrentUser(email);
            log('‚úÖ Usuario registrado exitosamente');
            showAppView(email);
        });
        
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            log('üîÑ Procesando login...');
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const users = getUsers();
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                setCurrentUser(email);
                log('‚úÖ Login exitoso');
                showAppView(email);
            } else {
                log('‚ùå Credenciales incorrectas');
                alert('Credenciales incorrectas');
            }
        });
        
        logoutBtn.addEventListener('click', () => {
            log('üö™ Cerrando sesi√≥n');
            showAuthView();
        });
        
        showUsersBtn.addEventListener('click', () => {
            const users = getUsers();
            log(`üë• Total usuarios: ${users.length}`);
            users.forEach((user, index) => {
                log(`${index + 1}. ${user.email}`);
            });
        });
        
        // Verificar sesi√≥n inicial
        function checkSession() {
            log('üîç Verificando sesi√≥n...');
            const currentUser = getCurrentUser();
            log(`üë§ Usuario actual: ${currentUser || 'ninguno'}`);
            
            if (currentUser) {
                showAppView(currentUser);
            } else {
                showAuthView();
            }
        }
        
        // Inicializar
        checkSession();
        log('üéØ Sistema de autenticaci√≥n inicializado');
    </script>
</body>
</html>